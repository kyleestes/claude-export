try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f0e3f7e0-bbfa-4a39-898f-42baa379dbdd",e._sentryDebugIdIdentifier="sentry-dbid-f0e3f7e0-bbfa-4a39-898f-42baa379dbdd")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7383],{1974:(e,t,n)=>{n.d(t,{PerformanceMetricsProvider:()=>h,B:()=>g});var r=n(54568);class i extends Error{}class a{add(e){this.buffer[this.head]=e,this.head=(this.head+1)%this.maxSize,this.currentSize<this.maxSize&&this.currentSize++}addAll(e){for(let t of e)this.add(t)}flush(){this.head=0,this.currentSize=0,this.buffer=Array(this.maxSize)}get size(){return this.currentSize}get isEmpty(){return 0===this.currentSize}get isFull(){return this.currentSize===this.maxSize}*values(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;for(let t=0;t<this.currentSize;t++){let n=(e+t)%this.maxSize;yield this.buffer[n]}}toArray(){return Array.from(this.values())}getLast(){if(0===this.currentSize)return;let e=(this.head-1+this.maxSize)%this.maxSize;return this.buffer[e]}getFirst(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;return this.buffer[e]}constructor(e){if(this.maxSize=e,this.head=0,this.currentSize=0,e<1)throw new i("RingBuffer maxSize must be 1 or more");this.buffer=Array(e)}}var s=n(74364),o=n(14008);class l{get mean(){return this.count>0?this._mean:0}get variance(){return this.count>1?this._m2/(this.count-1):0}get stdDev(){return Math.sqrt(this.variance)}calculate(){let e=this._tail-this._mean;this._mean+=e/this.count;let t=this._tail-this._mean;this._m2+=e*t}getSummary(){return{count:this.count,sum:this.sum,min:this.min,max:this.max,mean:this.mean,variance:this.variance,stdDev:this.stdDev}}reset(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._mean=0,this._m2=0}add(e){this.count+=1,this.sum+=e,this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this._tail=e,this.calculate()}constructor(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._tail=0,this._mean=0,this._m2=0,this.reset()}}class u{init(){if(this.shouldReportMemory=(0,s.Y)(),"PerformanceLongTaskTiming"in window)try{this.events.longTask.observer=this.initLongTaskObserver()}catch(e){console.error("PerfMon LongTaskObserver failed to init")}if("PerformanceEventTiming"in window)try{this.events.inputDelay.observer=this.initInputDelayObserver()}catch(e){console.error("PerfMon EventTimingObserver failed to init")}if("PerformanceLongAnimationFrameTiming"in window)try{this.events.longAnimationFrame.observer=this.initLongAnimationFrameObserver()}catch(e){console.error("PerfMon EventTimingObserver failed to init")}this.startReportMetricsInterval(),this.registerVisibilityHandlers()}initLongTaskObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let{attribution:e}=n;if(this.events.longTask.stats.add(n.duration),n.duration>=250){var t;this.events.longTask.buffer.add({start_time:n.startTime,duration_ms:n.duration,attribution_count:null!=(t=null==e?void 0:e.length)?t:0})}}});return e.observe({entryTypes:["longtask"]}),e}initInputDelayObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let e=n.processingStart?n.processingStart-n.startTime:0;if(e>100){this.events.inputDelay.stats.add(n.duration);let r=Number(n.processingEnd)-Number(n.processingStart);if(e>250||r>250){var t;this.events.inputDelay.buffer.add({start_time:n.startTime,duration_ms:e,processing_duration_ms:r,inp_duration_ms:n.duration,event_name:n.name,event_target_id:(null==(t=n.target)?void 0:t.id)||"unknown_target",is_fid:"first-input"===n.entryType})}}}});return e.observe({entryTypes:["event","first-input"]}),e}initLongAnimationFrameObserver(){let e=new PerformanceObserver(e=>{for(let t of e.getEntries()){let{blockingDuration:e}=t;if(this.events.longAnimationFrame.stats.add(t.duration),t.duration>=250){let n={start_time:t.startTime,duration_ms:t.duration,blocking_duration_ms:e||0};this.events.longAnimationFrame.buffer.add(n)}}});return e.observe({entryTypes:["long-animation-frame"]}),e}startReportMetricsInterval(){let e=()=>{this.reportMetricsTimeoutId=window.setTimeout(()=>{this.reportMetrics(),this.isActive&&e()},12e4)};e()}registerVisibilityHandlers(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.reportMetrics()},{passive:!0}),window.addEventListener("pagehide",()=>this.reportMetrics(),{passive:!0})}reportMetrics(){this.isActive&&(this.shouldReportMemory&&(0,o.r)("events.memory_snapshot",{metricType:"memory_snapshot"}),Object.values(this.events).forEach(e=>{let{name:t,stats:n,buffer:r}=e;0!==n.mean&&((0,o.r)("events.".concat(t,".summary"),{metricType:"".concat(t,"_summary"),performanceAttributes:{...n.getSummary()}}),r.toArray().forEach(e=>{let{duration_ms:n,...r}=e;(0,o.r)("events.".concat(t),{metricType:"".concat(t,"_event"),duration:n,performanceAttributes:{...r}})}),n.reset(),r.flush())}))}destroy(){this.isActive=!1,Object.values(this.events).forEach(e=>{var t;null==(t=e.observer)||t.disconnect(),e.observer=void 0}),clearTimeout(this.reportMetricsTimeoutId),this.reportMetricsTimeoutId=void 0,this.reportMetrics()}forceReport(){this.reportMetrics()}constructor(){this.isActive=!0,this.shouldReportMemory=!1,this.events={longTask:{name:"long_task",stats:new l,buffer:new a(100)},inputDelay:{name:"input_delay",stats:new l,buffer:new a(100)},longAnimationFrame:{name:"loaf",stats:new l,buffer:new a(100)}},this.init()}}var c=n(95199);class d{initPerfMon(){this.perfMon||(this.perfMon=new u)}trackNewChatInputReady(e,t){(0,o.r)("page.new_chat_input_ready",{duration:e,attributes:{is_first_load:t}}),c.C.clearParentContext()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};t.model&&(n["chat.model"]=t.model),(0,o.r)("chat.time_to_first_token",{metricType:"ttft",duration:e,attributes:n})}trackProjectConversationsReady(e){(0,o.r)("page.project_conversations_ready",{duration:e})}trackMembersListReady(e){(0,o.r)("page.members_list_ready",{duration:e})}constructor(){this.perfMon=null}}let f=new d;var m=n(62942),v=n(7620);let p=(0,v.createContext)(null);function h(e){let{children:t}=e,n=(0,m.usePathname)(),i=(0,v.useRef)(!0),a=(0,v.useRef)(null),s=(0,v.useRef)(!1),o=(0,v.useRef)(null),l=(0,v.useRef)(!1),u=(0,v.useRef)(null),c=(0,v.useRef)(!1),d=(0,v.useRef)(null),h=(0,v.useRef)(!1);(0,v.useEffect)(()=>{f.initPerfMon()},[]),(0,v.useEffect)(()=>{"/new"===n?(a.current=i.current?0:performance.now(),s.current=!1):(null==n?void 0:n.startsWith("/project/"))?(u.current=performance.now(),c.current=!1):"/settings/members"===n&&(d.current=performance.now(),h.current=!1),i.current=!1},[n]);let g=(0,v.useCallback)(()=>{if(s.current||null===a.current)return;s.current=!0;let e=performance.now()-a.current;f.trackNewChatInputReady(e,0===a.current),a.current=null},[]),y=(0,v.useCallback)(()=>{o.current=performance.now(),l.current=!1},[]),_=(0,v.useCallback)(e=>{if(null===o.current||l.current)return;l.current=!0;let t=performance.now()-o.current;f.trackTTFT(t,e),o.current=null},[]),b=(0,v.useCallback)(()=>{if(c.current||null===u.current)return;c.current=!0;let e=performance.now()-u.current;f.trackProjectConversationsReady(e),u.current=null},[]),S=(0,v.useCallback)(()=>{if(h.current||null===d.current)return;h.current=!0;let e=performance.now()-d.current;f.trackMembersListReady(e),d.current=null},[]),C=(0,v.useMemo)(()=>({markEditorReady:g,markMessageSent:y,markFirstTokenReceived:_,markProjectConversationsReady:b,markMembersListReady:S}),[g,y,_,b,S]);return(0,r.jsx)(p.Provider,{value:C,children:t})}function g(){let e=(0,v.useContext)(p);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},9896:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(27062),i=n(67933),a=n(7620),s=n(78217),o=n(85644);let l=()=>{let e="sticky-model-selector",{value:t}=(0,r.fS)("sticky_model_selector"),{value:n}=(0,r.fS)("model_selector_enabled"),{activeModelOptions:l}=(0,o.A9)(),u=(0,s.Z3)(null),c=(0,i.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===u?null:r&&l.find(e=>e.model===r)?r:null},initialData:null}),d=(0,a.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},17423:(e,t,n)=>{n.d(t,{M$:()=>c,O5:()=>o,f$:()=>l,lo:()=>u,n7:()=>d});var r=n(77186),i=n(1761),a=n(71473),s=n(87606);let o=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[a.ss,{orgUUID:t}]})},l=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,s.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[a.ss,{orgUUID:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.YL)(),o=null==n?void 0:n.uuid,l=(0,s.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(o,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[a.ss,{orgUUID:o}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,o=(0,s.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{o.invalidateQueries({queryKey:[a.ss,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},32442:(e,t,n)=>{function r(e){let t=e,n="",r=0;for(;t!==n&&r<10;)n=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),r++;if(r>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}n.d(t,{M:()=>function e(t){if("string"==typeof t)return r(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[r,i]of Object.entries(t))n[e(r)]=e(i);return n}return t},P:()=>r})},42685:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>l,T:()=>o});var r=n(54568),i=n(7620),a=n(71165);let s=null;function o(){s&&s(!0)}function l(){let[e,t]=(0,i.useState)(!1);return(0,i.useEffect)(()=>(s=t,()=>{s=null}),[]),(0,r.jsx)(a.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},45727:(e,t,n)=>{n.d(t,{p:()=>s});var r=n(46127),i=n(27062),a=n(17423);let s=()=>{let{value:e}=(0,i.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,a.O5)(),s=(null==t?void 0:t.defaultStyles)||[],o=[...s,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[l,u,c]=(0,r.Vc)("claude_personalized_style",null);if(n||!(null==o?void 0:o.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let d=s.length?s.find(e=>!0===e.isDefault)||s[0]:null;if(e&&(d=s.find(e=>"Concise"===e.key)||d),!l)return{personalizedStyleOptions:o,defaultStyle:d,storedStyle:l,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let f=o.find(e=>((e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t)(e,l.styleKey)),m=Date.now()-new Date(l.timestamp).getTime()>432e5;return{personalizedStyleOptions:o,storedStyle:f&&!m?f:null,defaultStyle:d,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e}}},57383:(e,t,n)=>{n.d(t,{_A:()=>x,oM:()=>I});var r=n(54568),i=n(64683),a=n(16253),s=n(74530),o=n(9896),l=n(70958),u=n(77186),c=n(29585),d=n(7620),f=n(13368),m=n(98736),v=n(89836),p=n(98251),h=n(67094),g=n(52909),y=n(1761),_=n(69916),b=n(45727),S=n(42685),C=n(1974),k=n(75973),T=n(12552),w=n(72431),E=n(93770),P=n(46127),M=n(32442);let U={type:"doc",content:[{type:"paragraph",content:[]}]},z=d.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,beamChatUuid:void 0,isNewBeamChat:!1,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,setBeamChatUuid:()=>void 0,setIsNewBeamChat:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),I=()=>d.useContext(z),x=e=>{var t,n,I,x,L,O,A;let{onSend:R,willRedirectOnSubmit:D,onCreate:F,onStopSampling:j,children:Y}=e,N="conversation"in e,Q="namespace"in e?e.namespace:void 0,K=N?e.conversation:void 0,q="projectUuid"in e?e.projectUuid:void 0,B=null!=(n=null==K?void 0:K.id)?n:void 0===q?"new-conversation":"".concat(q,":conversation"),V=(0,E.XL)(),G=(0,d.useMemo)(()=>(0,T.E)({enableV2:V,conversationId:B}),[B,V]),{incognitoModeEnabled:J}=(0,w.S)(),X=(0,d.useRef)(null);(0,d.useEffect)(()=>{(0,G.getState().setPromptInputRef)(X)},[G]);let{markMessageSent:W}=(0,C.B)(),H=(0,d.useCallback)(()=>{N&&j&&j()},[j,N]);(e=>{let t=(0,d.useCallback)(t=>{if(e&&!(e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")))(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&(e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))})(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,d.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])})(X.current);let{tipTapEditorState:$,setTipTapEditorText:Z,setTipTapEditorJSON:ee,isTipTapEditorStateUnsafe:et,attachments:en,setAttachments:er,files:ei,setFiles:ea,syncSourceUuids:es,setSyncSourceUuids:eo,clear:el}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r="".concat(n?"".concat(n,":"):"").concat(e),[i,a,o]=(0,P.Vc)("".concat(r,":attachment"),[]),[l,u,c]=(0,P.Vc)("".concat(r,":files"),[]),[f,m,v]=(0,P.Vc)("".concat(r,":syncSourceUuids"),[]),[p,h,g]=(0,P.Vc)("".concat(r,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:U),y=(0,d.useCallback)(()=>!!p.__ant_unsafe,[p]),_=(0,d.useCallback)((e,t)=>{let n=(0,M.P)(e),r={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(r.__ant_unsafe=!0),h(r),n},[h]);return{attachments:i,setAttachments:a,files:l,setFiles:u,syncSourceUuids:f,setSyncSourceUuids:m,tipTapEditorState:p,setTipTapEditorJSON:(0,d.useCallback)(e=>{let t=(0,s.h0)(e);return t.length>0&&y()&&(e.__ant_unsafe=!0),h(e),t},[h,y]),setTipTapEditorText:_,isTipTapEditorStateUnsafe:y,clear:(0,d.useCallback)(()=>{g(),o(),c(),v()},[o,g,c,v])}}(B,"",Q),eu=(0,d.useRef)($),ec=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(!V&&!ec.current){let e=eu.current?(0,s.h0)(eu.current):"";G.getState().setPrompt(e,{forceUpdateTiptap:!1}),ec.current=!0}},[G,V]);let ed=(0,f.P)(G,e=>e.prompt),ef=(0,d.useCallback)(e=>{if(V)G.getState().setTipTapEditorState(e);else{let t=ee(e);G.getState().setPrompt(t,{forceUpdateTiptap:!1})}},[ee,G,V]),em=(0,d.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(V)G.getState().setPrompt(e,{forceUpdateTiptap:!1});else{let r=Z(e,n);G.getState().setPrompt(r,{forceUpdateTiptap:t,unsafe:n})}},[Z,G,V]),ev=(0,v.NY)(es),ep=(0,v.qJ)(ev),eh=(0,u.B7)(ev),eg=en.length+ei.length+es.length>=a.XA.maxTotalUploadsPerMessage,{isModelSelectorOpen:ey,isSending:e_,isUploadingDriveSync:eb,isUploadingGithubSync:eS,personalizedStyle:eC,includeProfilePreferences:ek,currentCompassTask:eT}=(0,f.P)(G,(0,m.k)(e=>({isModelSelectorOpen:e.isModelSelectorOpen,isSending:e.isSending,isUploadingDriveSync:e.isUploadingDriveSync,isUploadingGithubSync:e.isUploadingGithubSync,personalizedStyle:e.personalizedStyle,includeProfilePreferences:e.includeProfilePreferences,currentCompassTask:e.currentCompassTask}))),ew=G.getState().setIsModelSelectorOpen,eE=G.getState().setIsSending,eP=G.getState().setIsUploadingDriveSync,eM=G.getState().setIsUploadingGithubSync,eU=G.getState().setPersonalizedStyle,ez=G.getState().setIncludeProfilePreferences,eI=G.getState().setCurrentCompassTask,ex=G.getState().setModel,eL=G.getState().setConversation,eO=G.getState().setPendingConversationSettings,eA=G.getState().setSyncSourceUuids,[eR,eD]=d.useState(),{stickyModelPreference:eF}=(0,o.F)(),ej=null!=(L=null!=(x=null!=(I=null==K?void 0:K.model)?I:eR)?x:eF)?L:void 0,[eY,eN]=d.useState(),eQ=(0,d.useMemo)(()=>({}),[]);(0,d.useLayoutEffect)(()=>{let e=G.getState();e.model!==ej&&ex(ej),e.conversation!==K&&eL(K);let t=null!=eY?eY:eQ,n=e.pendingConversationSettings,r=!n||0===Object.keys(n).length,i=!eY||0===Object.keys(eY).length;r&&i||n===t||eO(t),e.syncSourceUuids!==es&&eA(es)},[G,K,ej,es,eY,eQ,ex,eL,eO,eA]);let eK=(0,d.useCallback)(e=>{eN(t=>{let n={...t,...e};return eO(n),n})},[eO]),eq=(0,d.useCallback)(e=>{eo(e),eA(e)},[eo,eA]),[eB,eV]=d.useState(q),eG=(0,h.Ah)(),{mutate:eJ}=(0,p.nI)(),eX=(0,d.useCallback)(e=>{eV(e),eG&&e&&eJ&&eJ({project_uuid:e})},[eG,eJ]),eW=(0,g.ks)(eB),{beamUuid:eH}=(0,k.d)(),[e$,eZ]=d.useState(eH),[e0,e1]=d.useState(!1),e2=(0,d.useCallback)(e=>{eZ(e),e&&e1(!1)},[]),e7=(0,d.useCallback)(e=>{e1(e),e&&eZ(void 0)},[]),[e6,e9]=d.useState(),{storedStyle:e8,defaultStyle:e4}=(0,b.p)();(0,d.useEffect)(()=>{let e=null!=e8?e8:e4;!eC&&e&&eU(e)},[e8,e4,eC,eU]),(0,d.useEffect)(()=>{q&&eB!==q&&eX(q)},[q,eB,eX]);let e5="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,d.useEffect)(()=>{e9(void 0),eE(!1)},[null==K?void 0:K.id,eE]),(0,d.useEffect)(()=>{null==e5||e5(eC)},[eC,e5]);let e3=(0,d.useCallback)(async()=>{let e=G.getState().prompt,t=G.getState().setPrompt;if(X.current&&(""!==e.trim()||0!==en.length||0!==ei.length||0!==es.length)){D&&e9([...ei]),el(),G.getState().setPrompt("",{forceUpdateTiptap:!1}),D?X.current.setEditable(!1):X.current.setContent(""),eE(!0);try{if(W(),N&&R)await R({prompt:e,attachments:en,files:ei,syncSources:eh,personalized_style:eC}),eE(!1),e9(void 0);else{let t=G.getState().pendingConversationSettings;await F({prompt:e,attachments:en,files:ei,syncSources:eh,model:ej,project_uuid:eB,is_new_beam_chat:e0||void 0,beam_chat_uuid:e$,personalized_style:eC,include_conversation_preferences:ek,is_temporary:J,...t})}}catch(r){var n;if(t(e),null==(n=X.current)||n.setContent(e),er(en),ea(ei),eo(es),X.current.setEditable(!0),eE(!1),e9(void 0),r instanceof c.LG&&"opus_messages_rate_limit_exceeded"===r.errorCode)(0,S.T)();else throw r}}},[G,en,el,ei,ek,N,ej,F,R,eC,eB,er,ea,eo,es,eh,D,J,eE,W,e0,e$]),te=(0,d.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&N){eE(!0);try{R&&(await R({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eC}),eE(!1))}catch(e){if(e instanceof c.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,S.T)();else throw e;eE(!1)}}},[N,R,eC,eE]),{streamImprovement:tt,isStreaming:tn}=function(){let{activeOrganization:e}=(0,y.YL)(),[t,n]=(0,d.useState)(!1),[r,i]=(0,d.useState)(null),a=(0,d.useRef)(null),{addError:s}=(0,_.Y)(),o=(0,d.useCallback)(async(t,r,o,l)=>{a.current&&a.current.abort();let u=new AbortController;a.current=u,n(!0),i(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,f,m;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),i=new TextDecoder;if(!n)throw Error("No response body");let a="",s="",l=!1;for(;!l;){let e=await n.read();if(e.done){l=!0;break}let t=e.value,u=(a+=i.decode(t,{stream:!0})).split("\n");for(let e of(a=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(f=e.delta)?void 0:f.text)&&(s+=e.delta.text,r(e.delta.text));break;case"message_stop":o(e.improved_prompt||s);break;case"error":throw Error((null==(m=e.error)?void 0:m.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));i(e),null==l||l(e),s("Failed to improve prompt.",{error:e})}finally{n(!1),a.current===u&&(a.current=null)}},[null==e?void 0:e.uuid,s]);return(0,d.useEffect)(()=>()=>{a.current&&a.current.abort()},[]),{streamImprovement:o,isStreaming:t,error:r}}(),tr=(0,d.useCallback)(async()=>{var e,t,n,r;let i=G.getState().prompt,a=G.getState().setPrompt;if(!i.trim())return;null==(e=X.current)||e.setEditable(!1);let s="",o=!1;try{await tt({conversation_uuid:(null==K?void 0:K.id)||"new-conversation",prompt:i},e=>{var t,n,r;o||(o=!0,a(""),null==(r=X.current)||r.setContent("")),s+=e,a(s,{forceUpdateTiptap:!1}),null==(t=X.current)||t.setContent(s),null==(n=X.current)||n.scrollToEnd()},e=>{var t;a(e),null==(t=X.current)||t.setContent(e)},e=>{var t;a(i),null==(t=X.current)||t.setContent(i)})}catch(e){a(i),null==(t=X.current)||t.setContent(i)}finally{null==(n=X.current)||n.setEditable(!0),null==(r=X.current)||r.focus()}},[G,null==K?void 0:K.id,tt]),ti=(0,d.useCallback)(async e=>{let t=G.getState().prompt;if(eD(e),ex(e),N){eE(!0);try{var n;await F({prompt:t,attachments:en,files:ei,syncSources:eh,model:e,project_uuid:eB,create_mode:null==K||null==(n=K.conversationSettings)?void 0:n.create_mode,...eY})}finally{eE(!1)}}},[eY,en,ei,N,eB,F,G,eh,null==K||null==(t=K.conversationSettings)?void 0:t.create_mode,eE,ex]),ta=(0,d.useCallback)(()=>{var e;return null==(e=X.current)?void 0:e.focus()},[X]),[ts,to]=d.useState(!1),tl=(0,a.cV)(),tu=(0,l.u9)(),[tc,td,tf,tm,tv,tp,th,tg]=(0,i.Si)({syncSourceCount:es.length,attachments:en,setAttachments:er,numExistingConversationAttachments:null!=(O=null==K?void 0:K.attachmentsSoFar)?O:0,files:ei,setFiles:ea,numExistingConversationFiles:null!=(A=null==K?void 0:K.files.length)?A:0,detectSameAttachment:()=>!1,selectedModel:ej,conversationUuid:null==K?void 0:K.id,blobFileUploadsEnabled:tl,wiggleEnabled:null!=tu&&tu}),ty=en.length+ei.length,t_=es.length,tb=tc||eb||eS,tS=ty>0||t_>0||tb,tC=(0,d.useMemo)(()=>{var t;return{prompt:ed,tipTapEditorState:$,attachments:en,files:e.willRedirectOnSubmit&&e_?null!=e6?e6:[]:ei,syncSourceUuids:es,isAtMaxNumUploads:eg,isUploadingDriveSync:eb,isUploadingGithubSync:eS,model:ej,projectUuid:eB,beamChatUuid:e$,isNewBeamChat:e0,isChatSyncing:ep,personalizedStyle:eC,isProjectSyncing:eW,isNewConversation:void 0===K||0===K.messagesSoFar,isProjectLocked:void 0!==q||void 0!==K,isSending:e_,setPrompt:em,setTipTapEditorState:ef,setAttachments:er,setFiles:ea,setSyncSourceUuids:eq,setModel:ti,setProjectUuid:eX,setBeamChatUuid:e2,setIsNewBeamChat:e7,sendMessage:e3,sendTransparentMessage:te,improvePrompt:tr,isImprovingPrompt:tn,stopSampling:H,conversation:K,focusInput:ta,promptInputRef:X,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:ts,setHasBlockingWarning:to,setPersonalizedStyle:eU,setIsUploadingDriveSync:eP,setIsUploadingGithubSync:eM,includeProfilePreferences:ek,setIncludeProfilePreferences:ez,pendingConversationSettings:eY,setPendingConversationSettings:eK,isUploadingFile:tc,setIsUploadingFile:td,validateMaxUploadLimit:tf,onDrop:tm,onPasteFiles:tv,handleUpload:tp,uploadInputProps:tg,hasAttachments:tS,isModelSelectorOpen:ey,setIsModelSelectorOpen:ew,isPromptUnsafe:et,currentCompassTask:eT,setCurrentCompassTask:eI}},[en,K,ei,ta,q,ts,ek,eg,ep,eW,e_,eb,eS,ej,eC,eB,eX,e$,e0,ed,e.willRedirectOnSubmit,e3,te,tr,tn,er,ea,ti,eY,eK,e2,e7,em,eq,ef,H,es,$,e6,tc,td,tf,tm,tv,tp,tg,tS,ey,ew,et,eT,eI,ez,eP,eM,eU]);return(0,r.jsx)(E.jM,{value:G,children:(0,r.jsx)(z.Provider,{value:tC,children:Y})})}},67094:(e,t,n)=>{n.d(t,{Ah:()=>I,BV:()=>R,DO:()=>E,I_:()=>L,L1:()=>T,Mf:()=>w,P2:()=>D,PB:()=>M,Rb:()=>A,SK:()=>U,Sb:()=>b,UG:()=>P,Uq:()=>g,ey:()=>S,lH:()=>z,mM:()=>C,t5:()=>O,tW:()=>_,xt:()=>x});var r=n(68096),i=n(98518),a=n(77186),s=n(1761),o=n(69916),l=n(22529),u=n(71473),c=n(27062),d=n(87606),f=n(7620),m=n(46760),v=n(75006),p=n(98251),h=n(92075);let g="https://support.anthropic.com/articles/11817273-how-does-claude-s-memory-work",y=v.z.object({memory:v.z.string(),controls:v.z.array(v.z.string()).nullable(),updated_at:v.z.string().datetime({offset:!0}).nullable()}),_=(e,t)=>{var n;let{account:r,activeOrganization:i}=(0,s.YL)(),o=null==r?void 0:r.uuid,l=null==i?void 0:i.uuid,c=w(),d=e?"/api/organizations/".concat(l,"/memory?project_uuid=").concat(e):"/api/organizations/".concat(l,"/memory");return(0,a.Sk)(d,{queryKey:[u.IX,{accountUUID:o,orgUUID:l,projectUUID:e}],enabled:!!i&&(null==(n=null==t?void 0:t.enabled)||n)&&c},e=>y.parse(e))},b=()=>{let{account:e,activeOrganization:t}=(0,s.YL)(),n=null==e?void 0:e.uuid,r=null==t?void 0:t.uuid,i=w(),{addError:c}=(0,o.Y)(),f=(0,m.A)(),v=(0,d.useQueryClient)(),{mutate:p,isPending:h}=(0,a.L2)("/api/organizations/".concat(r,"/memory/synthesize"),"POST",{enabled:!!t&&i,onSuccess:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[a,s]=t;v.invalidateQueries({queryKey:[u.IX,{accountUUID:n,orgUUID:r,projectUUID:s.project_uuid}]})},onError:()=>{c((0,l.O)({id:"frigid_umbrella_sunflower",intl:f}))}});return{resynthesizeMemory:p,isResynthesizingMemory:h}},S=()=>{let e=(0,i.st)(),{activeOrganization:t}=(0,s.YL)(),n=null==t?void 0:t.uuid,r=w(),{addError:c}=(0,o.Y)(),f=(0,m.A)(),v=(0,d.useQueryClient)(),{mutate:p,isPending:h}=(0,a.L2)("/api/organizations/".concat(n,"/memory/reset"),"POST",{enabled:!!t&&r,onSuccess:()=>{v.invalidateQueries({queryKey:[u.IX]}),e.track({event_key:"claudeai.memory.memory_reset"})},onError:()=>{c((0,l.O)({id:"frog_book_coffee",intl:f}))}});return{resetMemory:p,isResettingMemory:h}},C=function(){let{projectUUID:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,i.st)(),{account:n,activeOrganization:r}=(0,s.YL)(),c=null==n?void 0:n.uuid,f=null==r?void 0:r.uuid,v=w(),{addError:p,addSuccess:h}=(0,o.Y)(),g=(0,m.A)(),y=(0,d.useQueryClient)(),{mutate:_,isPending:b}=(0,a.Qv)("/api/organizations/".concat(f,"/memory/controls"),"PUT",(e,t)=>{var n;return{memory:null!=(n=null==t?void 0:t.memory)?n:"",controls:e.controls,updated_at:null==t?void 0:t.updated_at}},{queryKey:[u.IX,{accountUUID:c,orgUUID:f,projectUUID:e}],enabled:!!r&&v,onSuccess:()=>{h((0,l.O)({id:"serif_net_popcorn",intl:g})),y.invalidateQueries({queryKey:[u.IX,{accountUUID:c,orgUUID:f,projectUUID:e}]}),t.track({event_key:"claudeai.memory.edit_memory",projectUUID:e})},onError:e=>{p((0,l.O)({id:"frigid_umbrella_sunflower",intl:g}),{error:e})}});return{updateMemoryControls:_,updateMemoryControlsIsPending:b}},k=()=>{let{value:e}=(0,c.fS)("claudeai_saffron_themes_enabled");return e},T=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=k(),r=t?"/api/organizations/".concat(t,"/memory/themes"):null;return(0,a.Sk)(r,{staleTime:3e5,enabled:!!t&&!!r&&n})},w=()=>{let{value:e}=(0,c.fS)("claudeai_saffron_enabled");return e},E=()=>{let{value:e}=(0,c.fS)("claudeai_saffron_admin_toggle_enabled"),t=w();return e&&!t},P=()=>{let e=k(),t=U();return e&&!!t},M=()=>{var e;let t=(0,s.mV)(),{data:n}=(0,h.rX)(),r=!!n&&!(null==(e=n.disabled_features)?void 0:e.includes("saffron"));return!t||r},U=()=>{var e;let t=M(),{account:n}=(0,s.YL)(),{value:r}=(0,c.fS)("claudeai_saffron_default_enabled");return!!t&&(null!=(e=null==n?void 0:n.settings.enabled_saffron)?e:r||void 0)},z=()=>{let e=(0,i.st)(),{account:t}=(0,s.YL)(),{mutate:n}=(0,r.Jy)(),{resetMemory:a}=S();return(r,i)=>{n({...null==t?void 0:t.settings,enabled_saffron:r}),(null==i?void 0:i.shouldResetMemory)&&a(),e.track({event_key:"claudeai.memory.account_setting_toggled",reset_memory:!!(null==i?void 0:i.shouldResetMemory)})}},I=()=>{let{value:e}=(0,c.fS)("claudeai_saffron_search_enabled");return e},x=()=>{let e=(0,i.st)(),{account:t}=(0,s.YL)(),n=(()=>{var e;let{account:t}=(0,s.YL)(),n=(()=>{let{value:e}=(0,c.fS)("claudeai_saffron_search_default_enabled");return e})();return null!=(e=null==t?void 0:t.settings.enabled_saffron_search)?e:n})(),a=I(),{mutate:o}=(0,r.Jy)(),{mutate:l}=(0,p.nI)(),u=(0,f.useRef)(null==t?void 0:t.settings);return(0,f.useEffect)(()=>{u.current=null==t?void 0:t.settings},[null==t?void 0:t.settings]),{toggleSaffronSearch:(0,f.useCallback)(t=>{o({...u.current,enabled_saffron_search:t}),a&&t&&l({}),e.track({event_key:"claudeai.conversation_search.account_setting_toggled"})},[o,l,a,e]),saffronSearchEnabled:n}},L=()=>{let{value:e}=(0,c.fS)("claudeai_saffron_ghost_enabled");return e},O=()=>(0,c.T9)("claudeai_saffron_frontend","resynthesize_enabled",!1,c.Km),A=()=>(0,c.T9)("claudeai_saffron_frontend","max_num_controls",10,c.T2),R=()=>(0,c.T9)("claudeai_saffron_frontend","max_control_chars",100,c.T2),D=function(){let{excludeGroveString:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,m.A)(),{value:n}=(0,c.fS)("claude_grove_enabled"),r=U();return!e&&n&&r?(0,l.O)({id:"heroic_sandwich_butterfly_saffron_grove",intl:t}):!e&&n?(0,l.O)({id:"heroic_sandwich_butterfly_grove",intl:t}):r?(0,l.O)({id:"heroic_sandwich_butterfly_saffron",intl:t}):(0,l.O)({id:"heroic_sandwich_butterfly",intl:t})}},72431:(e,t,n)=>{n.d(t,{S:()=>f,r:()=>m});var r=n(54568),i=n(98518),a=n(46612),s=n(89256),o=n.n(s),l=n(62942),u=n(7620),c=n(67094);let d=u.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:o(),temporaryConversationUUID:null,setTemporaryConversationUUID:o()}),f=()=>u.useContext(d),m=e=>{let{children:t}=e,n=(0,i.st)(),s=(0,l.useRouter)(),o=(0,l.useSearchParams)(),f=(0,c.I_)(),m=o.has(a.cn),[v,p]=(0,u.useState)(m),h=(0,u.useRef)(v),[g,y]=(0,u.useState)(null);(0,u.useEffect)(()=>{h.current=v},[v]),(0,u.useEffect)(()=>{m&&!v&&p(!0)},[m,v]);let _=(0,u.useCallback)(e=>{if(p(e),e)s.push("?".concat(a.cn));else{y(null);let e=new URLSearchParams(o.toString());e.delete(a.cn);let t=e.toString();s.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}n.track({event_key:"claudeai.incognito_mode.toggled",enabled:e})},[s,o,n]);(0,u.useEffect)(()=>{h.current&&!m&&_(!1)},[_,m]);let b=(0,u.useMemo)(()=>({incognitoModeEnabled:!!f&&v,setIncognitoModeEnabled:_,temporaryConversationUUID:f?g:null,setTemporaryConversationUUID:y}),[v,_,g,y,f]);return(0,r.jsx)(d.Provider,{value:b,children:t})}},75973:(e,t,n)=>{n.d(t,{d:()=>a}),n(54568),n(68096),n(1761),n(46127);var r=n(7620);let i=(0,r.createContext)({isInBeam:!1,beamUuid:void 0,beamConversationSettings:void 0,setBeamConversationSettings:void 0}),a=()=>(0,r.useContext)(i)},89836:(e,t,n)=>{n.d(t,{EF:()=>p,NY:()=>f,Ql:()=>g,VA:()=>h,YO:()=>v,qJ:()=>m});var r=n(77186),i=n(1761),a=n(46612),s=n(71473),o=n(77101),l=n(87606),u=n(7620),c=n(91768),d=n(93049);let f=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=!!(t&&e.length>0),o=(0,u.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),l=(0,u.useMemo)(()=>({queryKey:e.map(e=>[s.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:a,refetchInterval:e=>!!(e.state.data&&(0,c.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[a,n,e]);return(0,r._i)(o,l)},m=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,c.z3)(e.data)),v=e=>Math.ceil(f(e).reduce((e,t)=>{var n,r,i;return t.isLoading||!t.data?e:e+(null!=(i=null==(r=t.data)||null==(n=r.status)?void 0:n.current_size_bytes)?i:0)},0)/a.t2),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,i.YL)(),a=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,f=(0,l.useQueryClient)(),m=(0,c.eL)();return(0,r.L2)(()=>"/api/organizations/".concat(u,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,i,l,c=arguments.length,d=Array(c),m=0;m<c;m++)d[m]=arguments[m];let[v]=d;f.setQueryData([s.GC,{orgUuid:u,syncSourceUuid:v.uuid}],v),v.type===o.v8.GDRIVE&&v.config.uri&&(null==(t=v.status)?void 0:t.extra)&&(null==(n=v.status)?void 0:n.current_size_bytes)&&f.setQueryData([s.QB,{accountUUID:a,orgUUID:u,documentId:v.config.uri}],{uri:"drive:///".concat(v.config.uri),title:null==(i=v.status)?void 0:i.extra,size:null==(l=v.status)?void 0:l.current_size_bytes}),null==(r=e.onSuccess)||r.call(e,...d)},onError:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];null==(t=e.onError)||t.call(e,...r);let[a,s]=r;m(a,s),s.sync_source_type===o.v8.GDRIVE&&(0,d.D8)(s.sync_source_config.uri)}})},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,l.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];let[l]=i;a.setQueryData([s.GC,{orgUuid:n,syncSourceUuid:l.uuid}],l),null==(t=e.onSuccess)||t.call(e,...i)}})},g=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},93049:(e,t,n)=>{n.d(t,{Ac:()=>a,D8:()=>o,bI:()=>s});let r="recentDriveDocs";function i(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function a(e){localStorage.setItem(r,JSON.stringify(e))}function s(){if("undefined"==typeof localStorage)return[];let e=localStorage.getItem(r);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(i))return t}return[]}function o(e){let t=s();a(t=t.filter(t=>t.uri!==e))}}}]);