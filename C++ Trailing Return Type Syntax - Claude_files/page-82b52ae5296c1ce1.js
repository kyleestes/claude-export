try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f392ff48-bd1e-473f-83bb-6c3fcecf93f6",e._sentryDebugIdIdentifier="sentry-dbid-f392ff48-bd1e-473f-83bb-6c3fcecf93f6")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{28137:(e,t,s)=>{"use strict";s.d(t,{F:()=>u});var a=s(98518),n=s(1761),l=s(27062),i=s(7620),r=s(34116);let o="payment-verification-reminder-dismissed";function u(){let{activeOrganization:e}=(0,n.YL)(),t=(0,a.st)(),[s,u]=(0,i.useState)(!1),{value:d}=(0,l.fS)("show_3ds_modal"),{data:c}=(0,r.PI)(d);return(0,i.useEffect)(()=>{var s;let a=localStorage.getItem(o);if(a){let e=new Date(a).getTime();if(new Date().getTime()-e<864e5)return void u(!1)}let n=d&&null!=(s=null==c?void 0:c.requires_3ds_verification)&&s;u(n),n&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[d,c,t,e]),{shouldShowModal:s,dismissReminder:(0,i.useCallback)(()=>{let s=new Date().toISOString();localStorage.setItem(o,s),u(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:s})},[t,e])}}},42936:(e,t,s)=>{"use strict";s.d(t,{ChatClientPage:()=>P});var a=s(54568),n=s(7726),l=s(91961),i=s(95675),r=s(56273),o=s(1761),u=s(53248);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let s=Math.ceil(t/2);return"".concat(e.substring(0,s),"\n\n  [...]\n\n  ").concat(e.substring(e.length-s))}var c=s(7620),m=s(46760),f=s(78217),v=s(19303),p=s(2341),_=s(62942),g=s(1974),y=s(34144),h=s(57838),x=s(22126),j=s(98518),k=s(70659),b=s(92947),w=s(62370),S=s(28871),C=s(8027),A=s(11515),I=s(41417),M=s(37076),N=s(98411),E=s(62971),z=s(94748),D=s(13625),O=s(67532);function T(e){let{isModalOpen:t,currentTool:s,currentToolInput:n,currentServer:l,handleDeny:i,handleAllow:r,handleAlwaysAllow:o}=e,{isExpanded:u,setIsExpanded:d,snappyTransition:c}=(0,O.a)(!1);if(s)return(0,a.jsxs)(M.aF,{isOpen:t,onClose:()=>i(),autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,modalSize:"lg",title:(0,a.jsx)(E.A,{defaultMessage:"Claude would like to use this tool",id:"PwE/s/W1AC"}),children:[(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsx)(z.sH,{isStreaming:!1,isExpanded:u,setIsExpanded:d,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,a.jsx)(N.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)(A.d,{url:null==l?void 0:l.url,fallbackSvg:(0,a.jsx)(C.B,{letter:(null==l?void 0:l.name)||s.name,size:40}),size:40}),(0,a.jsxs)("div",{className:"flex flex-col py-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-400 font-mono",children:s.name}),(null==l?void 0:l.name)&&(0,a.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:l.name})]})]})}),className:"!h-auto",children:(0,a.jsx)(z.NG,{isExpanded:u,snappyTransition:c,isScrollable:!0,children:(0,a.jsx)(D.L,{input:n?JSON.parse(n):""})})}),(0,a.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,a.jsx)("p",{className:"font-medium",children:(0,a.jsx)(E.A,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,a.jsx)("p",{children:(0,a.jsx)(E.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,a.jsx)(M.vW,{className:"flex justify-between",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[o&&(0,a.jsx)(I.$,{onClick:o,children:(0,a.jsx)(E.A,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,a.jsx)(I.$,{onClick:r,autoFocus:!0,children:(0,a.jsx)(E.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,a.jsx)(I.$,{onClick:i,variant:"outline",children:(0,a.jsx)(E.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function F(e){var t,s,l;let{conversation:i,conversationUUID:r,chatInputDefaultMessage:C}=e,{data:A,isLoading:I,isPlaceholderData:M}=(0,n.Bq)(r,{suppressError:!0}),N=null==A?void 0:A.project_uuid,E=(0,y.gq)(),z=(0,y.xw)(r),{changeDisplayedConversationPath:D}=(0,v.G)(),{onInvokeTool:O,isModalOpen:F,currentTool:U,currentToolInput:P,currentServer:R,handleAllow:q,handleDeny:B,handleAlwaysAllow:L}=function(e){let{conversationUUID:t}=e,s=(0,x.M)(),{track:a}=(0,j.st)(),[n,l]=(0,c.useState)(!1),[i,r]=(0,c.useState)(null),[o,u]=(0,c.useState)(null),[d,m]=(0,c.useState)(void 0),[f,v]=(0,c.useState)(null),[p,_]=(0,c.useState)(null),[g,y]=(0,c.useState)(void 0),[h,C]=(0,c.useState)(!1),A=(0,k.p9)(),I=(0,b.HJ)(),{toggleMcpToolAlwaysApproved:M}=(0,b.es)(),{getApprovalSetting:N}=(0,b.BN)(),{mutate:E}=(0,k.p4)(t),z=(0,c.useCallback)(async(e,t,a,n,i,o,d)=>{let c=(0,w.pK)(t),f=null==c?void 0:c.tool,p=null==c?void 0:c.server;if(!f)return s(e,t,a,n,i);if(I)return;if(A&&(null==p?void 0:p.type)==="remote")return o?new Promise(e=>{r(t),m(p),u(f),v(a),_(n),C(o.includes("always")),y(d),l(!0),e()}):void 0;let g=N(null==p?void 0:p.name,f);return"never"===g?s(e,t,a,n,i):new Promise(e=>{r(t),C("ask"===g),m(p),u(f),v(a),_(n),l(!0),e()})},[s,N,A,I]),D=(0,c.useCallback)(()=>{l(!1),i&&null!==f&&null!==p&&(g?E({tool_use_id:f,is_approved:!0}):s(t,i,f,p))},[t,i,f,p,s,g,E]),O=(0,c.useCallback)(()=>{if(l(!1),i&&null!==f&&null!==p)if(g)E({tool_use_id:f,is_approved:!1});else{var e;s(t,i,f,p,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),a({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(e=(0,S.p)(p))?e:{}).length})}},[t,i,f,p,s,a,g,E]),T=(0,c.useCallback)(()=>{h&&(o&&!g&&M(o.alwaysApprovedKey,!0),l(!1),i&&null!==f&&null!==p&&(g&&E({tool_use_id:f,is_approved:!0,approval_key:g,approval_option:"always"}),s(t,i,f,p)))},[t,i,o,f,p,s,M,h,g,E]);return{onInvokeTool:z,isModalOpen:n,currentTool:o,currentServer:d,currentToolInput:p,handleAllow:D,handleDeny:O,handleAlwaysAllow:h?T:void 0}}({conversationUUID:r}),K=(0,f.Z3)(r),Y=(0,x.n)(null==A||null==(t=A.settings)?void 0:t.enabled_mcp_tools,null==i?void 0:i.project_uuid),{markFirstTokenReceived:Q}=(0,g.B)(),V=(0,c.useCallback)(()=>{Q({model:K})},[Q,K]),[W,G]=(0,c.useState)(),X=(0,c.useCallback)(e=>{G(e)},[G]),[H,Z]=(0,c.useState)(0),$=(0,c.useCallback)(e=>{Z(e)},[]),J=(0,f.Gw)(r,N,O,Y,V,E,$),ee=(0,f.SL)(r,N,O,Y,W,V,E,$),{mutate:et}=(0,n.lj)(r),es=J.isStreaming||ee.isStreaming,ea=(0,c.useCallback)(async e=>(Z(0),J.runStream(e)),[J]),en=(0,c.useCallback)(async(e,t,s,a)=>(Z(0),ee.runStream(e,t,s,a)),[ee]);!function(e,t){let[s,a]=(0,c.useState)(!1),{activeOrganization:l}=(0,o.YL)(),i=(0,m.A)(),r=e?e.uuid:"",{mutate:f}=(0,n.HI)(r),{mutate:v,error:p}=(0,n.OZ)(r),_=(0,c.useRef)(!1);(0,c.useEffect)(()=>{var t;if(!p||(null==e?void 0:e.name))return;let s=(null==e||null==(t=e.chat_messages)?void 0:t[0])?(0,u.C)(e.chat_messages[0]):"";if(s){if(_.current)return;let e=s.slice(0,30),t=s.length>30?"...":"";_.current=!0,f({name:"".concat(e).concat(t)})}},[p,e,f]),(0,c.useEffect)(()=>{if(t||s||(null==e?void 0:e.name))return;let n=null==e?void 0:e.chat_messages;if(!n||n.length<2||0===(0,u.C)(n[1]).length)return;let i=["Message 1:",d((0,u.C)(n[0])),"Message 2:",d((0,u.C)(n[1]))].join("\n\n");l&&(a(!0),v({message_content:i,recent_titles:[]}))},[t,s,e,l,v,i])}(A,es);let el=(0,c.useCallback)(async(e,t)=>{var s,a;await ea({prompt:t,attachments:e.attachments,files:null!=(a=e.files_v2)?a:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:W,compass_mode:null==(s=e.metadata)?void 0:s.compass_mode})},[ea,W]),ei=(0,c.useCallback)((e,t)=>{D(r,e,t,e=>et({current_leaf_message_uuid:e}))},[D,r,et]);A||I||M||(0,_.notFound)();let er=(0,c.useMemo)(()=>(null==A?void 0:A.settings)||{},[null==A?void 0:A.settings]);return(0,a.jsxs)(p.N,{settings:er,children:[(0,a.jsx)(h.v,{isStreaming:es,isTemporary:!!(null==i?void 0:i.is_temporary),chatInputDefaultMessage:C,conversationTitle:i?"".concat(i.name," - Claude"):"Claude",conversationUUID:r,isLoading:I,messageUuids:z,name:null!=(l=null!=(s=null==A?void 0:A.name)?s:null==i?void 0:i.name)?l:"Untitled Chat",onSend:ea,onRetry:en,projectUuid:N,changeDisplayedConversationPath:ei,editMessage:el,setPersonalizedStyleCallback:X,onToolAllow:q,retryCount:H}),(0,a.jsx)(T,{isModalOpen:F,currentTool:U,currentToolInput:P,currentServer:R,handleDeny:B,handleAllow:q,handleAlwaysAllow:L})]})}var U=s(55947);function P(e){let{uuid:t,q:s}=e,{data:o,currentPath:u,isLoading:d}=(0,n.Bq)(t);(0,l.K7)(null!=(m=null==o?void 0:o.name)?m:"");var m,f=u||[];let v=(0,y.Gu)(),p=(0,c.useRef)(t);return(0,c.useLayoutEffect)(()=>{t!==p.current&&d?(v(t,[]),p.current=t):!d&&f.length>0&&(v(t,f),p.current=t)},[t,f,d,v]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.u,{conversationUUID:t,children:(0,a.jsx)(i._,{conversationUUID:t,children:(0,a.jsx)(F,{conversation:o,conversationUUID:t,chatInputDefaultMessage:s})})}),(0,a.jsx)(U.T,{})]})}},55947:(e,t,s)=>{"use strict";s.d(t,{T:()=>p});var a=s(54568),n=s(98518),l=s(1761),i=s(69916),r=s(78730),o=s(86030),u=s(37076),d=s(87606),c=s(7620),m=s(62971),f=s(34116),v=s(28137);function p(){let[e,t]=(0,c.useState)(!1),s=(0,n.st)(),{activeOrganization:p}=(0,l.YL)(),{addError:_,addSuccess:g}=(0,i.Y)(),y=(0,r.ib)(),h=(0,d.useQueryClient)(),{shouldShowModal:x,dismissReminder:j}=(0,v.F)(),k=(0,f.Si)({onSuccess:async e=>{try{var n,l;let t=await y;if(!t)throw Error("Stripe failed to initialize");let i=await t.retrieveSetupIntent(e.clientSecret);if(i.error)throw Error(i.error.message);if((null==(n=i.setupIntent)?void 0:n.status)==="requires_action"){let s=await t.handleNextAction({clientSecret:e.clientSecret});if(s.error)throw Error(s.error.message)}else(null==(l=i.setupIntent)?void 0:l.status)==="succeeded"&&s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success_frictionless"});await h.invalidateQueries({queryKey:["check-3ds-required",null==p?void 0:p.uuid]}),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success"}),g((0,a.jsx)(m.A,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_success"})}catch(e){_(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"}),{error:e}),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),_((0,a.jsx)(m.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"}),{error:e}),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),b=()=>{j()};return x?(0,a.jsx)(u.aF,{isOpen:x,onClose:b,modalSize:"md",hasCloseButton:!0,title:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(o.E,{color:"secondary",size:"lg",children:(0,a.jsx)(m.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,a.jsx)(m.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,a.jsx)("p",{className:"text-text-200 mb-6",children:(0,a.jsx)(m.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,a.jsx)(u.yl,{onClick:()=>{t(!0),s.track({event_key:"payment_modal_open",organization_id:null==p?void 0:p.uuid,action:"verify_3ds_start"});let e=window.location.href;k.mutate({return_url:e})},loading:e,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,a.jsx)(u.yl,{variant:"secondary",onClick:b,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},68708:(e,t,s)=>{Promise.resolve().then(s.bind(s,42936))}},e=>{e.O(0,[1658,4129,3473,7598,2971,2846,7261,7463,6724,5006,1036,1575,9474,125,7773,5469,6604,6631,5388,3970,8864,631,497,2720,887,6975,5027,8223,4478,9437,823,45,4548,3904,1570,6533,4617,9140,5328,1761,8518,2198,7054,4116,8217,5711,3805,4551,1544,9829,8711,7383,5194,1203,1336,9486,8185,4187,8194,953,629,3592,6053,4384,6903,7143,7561,5777,4647,8354,2495,7354,7838,5313,587,4490,7358],()=>e(e.s=68708)),_N_E=e.O()}]);